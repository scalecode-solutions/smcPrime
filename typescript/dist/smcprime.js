"use strict";
/**
 * smcPrime - Ultra-fast primality testing
 *
 * Deterministic primality testing for 32-bit and 64-bit integers using
 * Montgomery arithmetic and optimal Miller-Rabin witnesses.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.isPrime32 = isPrime32;
exports.nextPrime32 = nextPrime32;
exports.prevPrime32 = prevPrime32;
exports.isPrime64 = isPrime64;
exports.nextPrime64 = nextPrime64;
exports.prevPrime64 = prevPrime64;
exports.isPrime = isPrime;
exports.nextPrime = nextPrime;
exports.prevPrime = prevPrime;
const MASK32 = 0xffffffffn;
const MASK64 = 0xffffffffffffffffn;
// ============================================================================
// 32-BIT PRIMALITY TESTING
// ============================================================================
function mulmod32(a, b, m) {
    return (a * b) % m;
}
function powmod32(a, b, m) {
    let r = 1n;
    a = a % m;
    while (b > 0n) {
        if (b & 1n)
            r = mulmod32(r, a, m);
        b >>= 1n;
        if (b > 0n)
            a = mulmod32(a, a, m);
    }
    return r;
}
function sprp32(n, a) {
    if (a % n === 0n)
        return true;
    let d = n - 1n;
    let s = 0n;
    while ((d & 1n) === 0n) {
        d >>= 1n;
        s++;
    }
    let x = powmod32(a, d, n);
    if (x === 1n || x === n - 1n)
        return true;
    for (let r = 1n; r < s; r++) {
        x = mulmod32(x, x, n);
        if (x === n - 1n)
            return true;
        if (x === 1n)
            return false;
    }
    return false;
}
/**
 * Deterministic primality test for 32-bit integers
 * Uses witnesses {2, 7, 61} which are sufficient for all n < 2^32
 */
function isPrime32(n) {
    const bn = BigInt(n);
    if (bn < 2n)
        return false;
    if (bn === 2n)
        return true;
    if ((bn & 1n) === 0n)
        return false;
    if (bn < 9n)
        return true;
    if (bn % 3n === 0n || bn % 5n === 0n || bn % 7n === 0n)
        return false;
    if (bn === 3215031751n)
        return false;
    return sprp32(bn, 2n) && sprp32(bn, 7n) && sprp32(bn, 61n);
}
/** Find the next prime >= n (32-bit) */
function nextPrime32(n) {
    let bn = BigInt(n);
    if (bn <= 2n)
        return 2n;
    if ((bn & 1n) === 0n)
        bn++;
    while (!isPrime32(bn)) {
        bn += 2n;
        if (bn > MASK32)
            return 0n;
    }
    return bn;
}
/** Find the previous prime <= n (32-bit) */
function prevPrime32(n) {
    let bn = BigInt(n);
    if (bn < 2n)
        return 0n;
    if (bn === 2n)
        return 2n;
    if ((bn & 1n) === 0n)
        bn--;
    while (!isPrime32(bn)) {
        if (bn < 3n)
            return 2n;
        bn -= 2n;
    }
    return bn;
}
// ============================================================================
// 64-BIT PRIMALITY TESTING (Montgomery Arithmetic)
// ============================================================================
function montInv64(n) {
    let est = ((3n * n) ^ 2n) & MASK64;
    est = ((2n - est * n) * est) & MASK64;
    est = ((2n - est * n) * est) & MASK64;
    est = ((2n - est * n) * est) & MASK64;
    est = ((2n - est * n) * est) & MASK64;
    return est;
}
function montReduce64(xLo, xHi, n, nInv) {
    const m = (xLo * nInv) & MASK64;
    const t = (m * n) >> 64n;
    if (xHi < t) {
        return ((xHi - t) & MASK64) + n;
    }
    return xHi - t;
}
function montMul64(a, b, n, nInv) {
    const prod = a * b;
    return montReduce64(prod & MASK64, prod >> 64n, n, nInv);
}
function toMont64(x, n) {
    return ((x % n) << 64n) % n;
}
function montOne64(n) {
    return (MASK64 % n) + 1n;
}
function montPow64(base, exp, n, nInv, one) {
    let result = one;
    while (exp > 0n) {
        if (exp & 1n)
            result = montMul64(result, base, n, nInv);
        base = montMul64(base, base, n, nInv);
        exp >>= 1n;
    }
    return result;
}
function montSprp64(n, a, nInv, one) {
    let d = n - 1n;
    let s = 0n;
    while ((d & 1n) === 0n) {
        d >>= 1n;
        s++;
    }
    const aMont = toMont64(a % n, n);
    if (aMont === 0n)
        return true;
    let x = montPow64(aMont, d, n, nInv, one);
    const negOne = n - one;
    if (x === one || x === negOne)
        return true;
    for (let r = 1n; r < s; r++) {
        x = montMul64(x, x, n, nInv);
        if (x === negOne)
            return true;
        if (x === one)
            return false;
    }
    return false;
}
/**
 * Deterministic primality test for 64-bit integers
 * Uses Montgomery-based Miller-Rabin with optimal witnesses
 */
function isPrime64(n) {
    const bn = BigInt(n);
    if (bn < 2n)
        return false;
    if (bn === 2n)
        return true;
    if ((bn & 1n) === 0n)
        return false;
    if (bn < 9n)
        return true;
    if (bn % 3n === 0n || bn % 5n === 0n || bn % 7n === 0n)
        return false;
    if (bn === 3215031751n)
        return false;
    // For small n, use 32-bit version
    if (bn <= MASK32) {
        return isPrime32(bn);
    }
    const nInv = montInv64(bn);
    const one = montOne64(bn);
    const witnesses = [2n, 3n, 5n, 7n, 11n, 13n, 17n, 19n, 23n, 29n, 31n, 37n];
    for (const w of witnesses) {
        if (!montSprp64(bn, w, nInv, one))
            return false;
    }
    return true;
}
/** Find the next prime >= n (64-bit) */
function nextPrime64(n) {
    let bn = BigInt(n);
    if (bn <= 2n)
        return 2n;
    if ((bn & 1n) === 0n)
        bn++;
    while (!isPrime64(bn)) {
        bn += 2n;
        if (bn > MASK64)
            return 0n;
    }
    return bn;
}
/** Find the previous prime <= n (64-bit) */
function prevPrime64(n) {
    let bn = BigInt(n);
    if (bn < 2n)
        return 0n;
    if (bn === 2n)
        return 2n;
    if ((bn & 1n) === 0n)
        bn--;
    while (!isPrime64(bn)) {
        if (bn < 3n)
            return 2n;
        bn -= 2n;
    }
    return bn;
}
// ============================================================================
// DEFAULT ALIASES (64-bit)
// ============================================================================
/** Primality test (defaults to 64-bit) */
function isPrime(n) {
    return isPrime64(n);
}
/** Find next prime (defaults to 64-bit) */
function nextPrime(n) {
    return nextPrime64(n);
}
/** Find previous prime (defaults to 64-bit) */
function prevPrime(n) {
    return prevPrime64(n);
}
// Test when run directly
if (typeof require !== 'undefined' && require.main === module) {
    console.log("Testing smcPrime...");
    // Test small primes
    const primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47];
    for (const p of primes) {
        if (!isPrime(p)) {
            console.error(`FAIL: ${p} should be prime`);
            process.exit(1);
        }
    }
    // Test composites
    const composites = [4, 6, 8, 9, 10, 12, 14, 15, 16, 18, 20, 21, 22, 24, 25];
    for (const c of composites) {
        if (isPrime(c)) {
            console.error(`FAIL: ${c} should not be prime`);
            process.exit(1);
        }
    }
    // Test special pseudoprime
    if (isPrime(3215031751)) {
        console.error("FAIL: 3215031751 should not be prime");
        process.exit(1);
    }
    // Test next/prev prime
    if (nextPrime(100) !== 101n) {
        console.error("FAIL: nextPrime(100) should be 101");
        process.exit(1);
    }
    if (prevPrime(100) !== 97n) {
        console.error("FAIL: prevPrime(100) should be 97");
        process.exit(1);
    }
    // Test large prime
    if (!isPrime64(1000000007n)) {
        console.error("FAIL: 1000000007 should be prime");
        process.exit(1);
    }
    console.log("All tests passed!");
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic21jcHJpbWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zbWNwcmltZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7O0FBMkNILDhCQVNDO0FBR0Qsa0NBU0M7QUFHRCxrQ0FVQztBQXdFRCw4QkFzQkM7QUFHRCxrQ0FTQztBQUdELGtDQVVDO0FBT0QsMEJBRUM7QUFHRCw4QkFFQztBQUdELDhCQUVDO0FBck5ELE1BQU0sTUFBTSxHQUFHLFdBQVcsQ0FBQztBQUMzQixNQUFNLE1BQU0sR0FBRyxtQkFBbUIsQ0FBQztBQUVuQywrRUFBK0U7QUFDL0UsMkJBQTJCO0FBQzNCLCtFQUErRTtBQUUvRSxTQUFTLFFBQVEsQ0FBQyxDQUFTLEVBQUUsQ0FBUyxFQUFFLENBQVM7SUFDN0MsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDdkIsQ0FBQztBQUVELFNBQVMsUUFBUSxDQUFDLENBQVMsRUFBRSxDQUFTLEVBQUUsQ0FBUztJQUM3QyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDWCxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNWLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDO1FBQ1osSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNsQyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ1QsSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBQ0QsT0FBTyxDQUFDLENBQUM7QUFDYixDQUFDO0FBRUQsU0FBUyxNQUFNLENBQUMsQ0FBUyxFQUFFLENBQVM7SUFDaEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUU7UUFBRSxPQUFPLElBQUks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T0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsc0JBQXNCLENBQUMsQ0FBQztZQUNoRCxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLENBQUM7SUFDTCxDQUFDO0lBRUQsMkJBQTJCO0lBQzNCLElBQUksT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7UUFDdEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO1FBQ3RELE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVELHVCQUF1QjtJQUN2QixJQUFJLFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUMxQixPQUFPLENBQUMsS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7UUFDcEQsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBQ0QsSUFBSSxTQUFTLENBQUMsR0FBRyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDekIsT0FBTyxDQUFDLEtBQUssQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO1FBQ25ELE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVELG1CQUFtQjtJQUNuQixJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7UUFDMUIsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1FBQ2xELE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUNyQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBzbWNQcmltZSAtIFVsdHJhLWZhc3QgcHJpbWFsaXR5IHRlc3RpbmdcbiAqIFxuICogRGV0ZXJtaW5pc3RpYyBwcmltYWxpdHkgdGVzdGluZyBmb3IgMzItYml0IGFuZCA2NC1iaXQgaW50ZWdlcnMgdXNpbmdcbiAqIE1vbnRnb21lcnkgYXJpdGhtZXRpYyBhbmQgb3B0aW1hbCBNaWxsZXItUmFiaW4gd2l0bmVzc2VzLlxuICovXG5cbmNvbnN0IE1BU0szMiA9IDB4RkZGRkZGRkZuO1xuY29uc3QgTUFTSzY0ID0gMHhGRkZGRkZGRkZGRkZGRkZGbjtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gMzItQklUIFBSSU1BTElUWSBURVNUSU5HXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIG11bG1vZDMyKGE6IGJpZ2ludCwgYjogYmlnaW50LCBtOiBiaWdpbnQpOiBiaWdpbnQge1xuICAgIHJldHVybiAoYSAqIGIpICUgbTtcbn1cblxuZnVuY3Rpb24gcG93bW9kMzIoYTogYmlnaW50LCBiOiBiaWdpbnQsIG06IGJpZ2ludCk6IGJpZ2ludCB7XG4gICAgbGV0IHIgPSAxbjtcbiAgICBhID0gYSAlIG07XG4gICAgd2hpbGUgKGIgPiAwbikge1xuICAgICAgICBpZiAoYiAmIDFuKSByID0gbXVsbW9kMzIociwgYSwgbSk7XG4gICAgICAgIGIgPj49IDFuO1xuICAgICAgICBpZiAoYiA+IDBuKSBhID0gbXVsbW9kMzIoYSwgYSwgbSk7XG4gICAgfVxuICAgIHJldHVybiByO1xufVxuXG5mdW5jdGlvbiBzcHJwMzIobjogYmlnaW50LCBhOiBiaWdpbnQpOiBib29sZWFuIHtcbiAgICBpZiAoYSAlIG4gPT09IDBuKSByZXR1cm4gdHJ1ZTtcbiAgICBsZXQgZCA9IG4gLSAxbjtcbiAgICBsZXQgcyA9IDBuO1xuICAgIHdoaWxlICgoZCAmIDFuKSA9PT0gMG4pIHsgZCA+Pj0gMW47IHMrKzsgfVxuICAgIGxldCB4ID0gcG93bW9kMzIoYSwgZCwgbik7XG4gICAgaWYgKHggPT09IDFuIHx8IHggPT09IG4gLSAxbikgcmV0dXJuIHRydWU7XG4gICAgZm9yIChsZXQgciA9IDFuOyByIDwgczsgcisrKSB7XG4gICAgICAgIHggPSBtdWxtb2QzMih4LCB4LCBuKTtcbiAgICAgICAgaWYgKHggPT09IG4gLSAxbikgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmICh4ID09PSAxbikgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbi8qKlxuICogRGV0ZXJtaW5pc3RpYyBwcmltYWxpdHkgdGVzdCBmb3IgMzItYml0IGludGVnZXJzXG4gKiBVc2VzIHdpdG5lc3NlcyB7MiwgNywgNjF9IHdoaWNoIGFyZSBzdWZmaWNpZW50IGZvciBhbGwgbiA8IDJeMzJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzUHJpbWUzMihuOiBudW1iZXIgfCBiaWdpbnQpOiBib29sZWFuIHtcbiAgICBjb25zdCBibiA9IEJpZ0ludChuKTtcbiAgICBpZiAoYm4gPCAybikgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChibiA9PT0gMm4pIHJldHVybiB0cnVlO1xuICAgIGlmICgoYm4gJiAxbikgPT09IDBuKSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGJuIDwgOW4pIHJldHVybiB0cnVlO1xuICAgIGlmIChibiAlIDNuID09PSAwbiB8fCBibiAlIDVuID09PSAwbiB8fCBibiAlIDduID09PSAwbikgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChibiA9PT0gMzIxNTAzMTc1MW4pIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gc3BycDMyKGJuLCAybikgJiYgc3BycDMyKGJuLCA3bikgJiYgc3BycDMyKGJuLCA2MW4pO1xufVxuXG4vKiogRmluZCB0aGUgbmV4dCBwcmltZSA+PSBuICgzMi1iaXQpICovXG5leHBvcnQgZnVuY3Rpb24gbmV4dFByaW1lMzIobjogbnVtYmVyIHwgYmlnaW50KTogYmlnaW50IHtcbiAgICBsZXQgYm4gPSBCaWdJbnQobik7XG4gICAgaWYgKGJuIDw9IDJuKSByZXR1cm4gMm47XG4gICAgaWYgKChibiAmIDFuKSA9PT0gMG4pIGJuKys7XG4gICAgd2hpbGUgKCFpc1ByaW1lMzIoYm4pKSB7XG4gICAgICAgIGJuICs9IDJuO1xuICAgICAgICBpZiAoYm4gPiBNQVNLMzIpIHJldHVybiAwbjtcbiAgICB9XG4gICAgcmV0dXJuIGJuO1xufVxuXG4vKiogRmluZCB0aGUgcHJldmlvdXMgcHJpbWUgPD0gbiAoMzItYml0KSAqL1xuZXhwb3J0IGZ1bmN0aW9uIHByZXZQcmltZTMyKG46IG51bWJlciB8IGJpZ2ludCk6IGJpZ2ludCB7XG4gICAgbGV0IGJuID0gQmlnSW50KG4pO1xuICAgIGlmIChibiA8IDJuKSByZXR1cm4gMG47XG4gICAgaWYgKGJuID09PSAybikgcmV0dXJuIDJuO1xuICAgIGlmICgoYm4gJiAxbikgPT09IDBuKSBibi0tO1xuICAgIHdoaWxlICghaXNQcmltZTMyKGJuKSkge1xuICAgICAgICBpZiAoYm4gPCAzbikgcmV0dXJuIDJuO1xuICAgICAgICBibiAtPSAybjtcbiAgICB9XG4gICAgcmV0dXJuIGJuO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA2NC1CSVQgUFJJTUFMSVRZIFRFU1RJTkcgKE1vbnRnb21lcnkgQXJpdGhtZXRpYylcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gbW9udEludjY0KG46IGJpZ2ludCk6IGJpZ2ludCB7XG4gICAgbGV0IGVzdCA9ICgoM24gKiBuKSBeIDJuKSAmIE1BU0s2NDtcbiAgICBlc3QgPSAoKDJuIC0gZXN0ICogbikgKiBlc3QpICYgTUFTSzY0O1xuICAgIGVzdCA9ICgoMm4gLSBlc3QgKiBuKSAqIGVzdCkgJiBNQVNLNjQ7XG4gICAgZXN0ID0gKCgybiAtIGVzdCAqIG4pICogZXN0KSAmIE1BU0s2NDtcbiAgICBlc3QgPSAoKDJuIC0gZXN0ICogbikgKiBlc3QpICYgTUFTSzY0O1xuICAgIHJldHVybiBlc3Q7XG59XG5cbmZ1bmN0aW9uIG1vbnRSZWR1Y2U2NCh4TG86IGJpZ2ludCwgeEhpOiBiaWdpbnQsIG46IGJpZ2ludCwgbkludjogYmlnaW50KTogYmlnaW50IHtcbiAgICBjb25zdCBtID0gKHhMbyAqIG5JbnYpICYgTUFTSzY0O1xuICAgIGNvbnN0IHQgPSAobSAqIG4pID4+IDY0bjtcbiAgICBpZiAoeEhpIDwgdCkge1xuICAgICAgICByZXR1cm4gKCh4SGkgLSB0KSAmIE1BU0s2NCkgKyBuO1xuICAgIH1cbiAgICByZXR1cm4geEhpIC0gdDtcbn1cblxuZnVuY3Rpb24gbW9udE11bDY0KGE6IGJpZ2ludCwgYjogYmlnaW50LCBuOiBiaWdpbnQsIG5JbnY6IGJpZ2ludCk6IGJpZ2ludCB7XG4gICAgY29uc3QgcHJvZCA9IGEgKiBiO1xuICAgIHJldHVybiBtb250UmVkdWNlNjQocHJvZCAmIE1BU0s2NCwgcHJvZCA+PiA2NG4sIG4sIG5JbnYpO1xufVxuXG5mdW5jdGlvbiB0b01vbnQ2NCh4OiBiaWdpbnQsIG46IGJpZ2ludCk6IGJpZ2ludCB7XG4gICAgcmV0dXJuICgoeCAlIG4pIDw8IDY0bikgJSBuO1xufVxuXG5mdW5jdGlvbiBtb250T25lNjQobjogYmlnaW50KTogYmlnaW50IHtcbiAgICByZXR1cm4gKE1BU0s2NCAlIG4pICsgMW47XG59XG5cbmZ1bmN0aW9uIG1vbnRQb3c2NChiYXNlOiBiaWdpbnQsIGV4cDogYmlnaW50LCBuOiBiaWdpbnQsIG5JbnY6IGJpZ2ludCwgb25lOiBiaWdpbnQpOiBiaWdpbnQge1xuICAgIGxldCByZXN1bHQgPSBvbmU7XG4gICAgd2hpbGUgKGV4cCA+IDBuKSB7XG4gICAgICAgIGlmIChleHAgJiAxbikgcmVzdWx0ID0gbW9udE11bDY0KHJlc3VsdCwgYmFzZSwgbiwgbkludik7XG4gICAgICAgIGJhc2UgPSBtb250TXVsNjQoYmFzZSwgYmFzZSwgbiwgbkludik7XG4gICAgICAgIGV4cCA+Pj0gMW47XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIG1vbnRTcHJwNjQobjogYmlnaW50LCBhOiBiaWdpbnQsIG5JbnY6IGJpZ2ludCwgb25lOiBiaWdpbnQpOiBib29sZWFuIHtcbiAgICBsZXQgZCA9IG4gLSAxbjtcbiAgICBsZXQgcyA9IDBuO1xuICAgIHdoaWxlICgoZCAmIDFuKSA9PT0gMG4pIHsgZCA+Pj0gMW47IHMrKzsgfVxuICAgIFxuICAgIGNvbnN0IGFNb250ID0gdG9Nb250NjQoYSAlIG4sIG4pO1xuICAgIGlmIChhTW9udCA9PT0gMG4pIHJldHVybiB0cnVlO1xuICAgIFxuICAgIGxldCB4ID0gbW9udFBvdzY0KGFNb250LCBkLCBuLCBuSW52LCBvbmUpO1xuICAgIGNvbnN0IG5lZ09uZSA9IG4gLSBvbmU7XG4gICAgXG4gICAgaWYgKHggPT09IG9uZSB8fCB4ID09PSBuZWdPbmUpIHJldHVybiB0cnVlO1xuICAgIFxuICAgIGZvciAobGV0IHIgPSAxbjsgciA8IHM7IHIrKykge1xuICAgICAgICB4ID0gbW9udE11bDY0KHgsIHgsIG4sIG5JbnYpO1xuICAgICAgICBpZiAoeCA9PT0gbmVnT25lKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKHggPT09IG9uZSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbi8qKlxuICogRGV0ZXJtaW5pc3RpYyBwcmltYWxpdHkgdGVzdCBmb3IgNjQtYml0IGludGVnZXJzXG4gKiBVc2VzIE1vbnRnb21lcnktYmFzZWQgTWlsbGVyLVJhYmluIHdpdGggb3B0aW1hbCB3aXRuZXNzZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzUHJpbWU2NChuOiBudW1iZXIgfCBiaWdpbnQpOiBib29sZWFuIHtcbiAgICBjb25zdCBibiA9IEJpZ0ludChuKTtcbiAgICBpZiAoYm4gPCAybikgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChibiA9PT0gMm4pIHJldHVybiB0cnVlO1xuICAgIGlmICgoYm4gJiAxbikgPT09IDBuKSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGJuIDwgOW4pIHJldHVybiB0cnVlO1xuICAgIGlmIChibiAlIDNuID09PSAwbiB8fCBibiAlIDVuID09PSAwbiB8fCBibiAlIDduID09PSAwbikgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChibiA9PT0gMzIxNTAzMTc1MW4pIHJldHVybiBmYWxzZTtcbiAgICBcbiAgICAvLyBGb3Igc21hbGwgbiwgdXNlIDMyLWJpdCB2ZXJzaW9uXG4gICAgaWYgKGJuIDw9IE1BU0szMikge1xuICAgICAgICByZXR1cm4gaXNQcmltZTMyKGJuKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgbkludiA9IG1vbnRJbnY2NChibik7XG4gICAgY29uc3Qgb25lID0gbW9udE9uZTY0KGJuKTtcbiAgICBcbiAgICBjb25zdCB3aXRuZXNzZXMgPSBbMm4sIDNuLCA1biwgN24sIDExbiwgMTNuLCAxN24sIDE5biwgMjNuLCAyOW4sIDMxbiwgMzduXTtcbiAgICBmb3IgKGNvbnN0IHcgb2Ygd2l0bmVzc2VzKSB7XG4gICAgICAgIGlmICghbW9udFNwcnA2NChibiwgdywgbkludiwgb25lKSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqIEZpbmQgdGhlIG5leHQgcHJpbWUgPj0gbiAoNjQtYml0KSAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5leHRQcmltZTY0KG46IG51bWJlciB8IGJpZ2ludCk6IGJpZ2ludCB7XG4gICAgbGV0IGJuID0gQmlnSW50KG4pO1xuICAgIGlmIChibiA8PSAybikgcmV0dXJuIDJuO1xuICAgIGlmICgoYm4gJiAxbikgPT09IDBuKSBibisrO1xuICAgIHdoaWxlICghaXNQcmltZTY0KGJuKSkge1xuICAgICAgICBibiArPSAybjtcbiAgICAgICAgaWYgKGJuID4gTUFTSzY0KSByZXR1cm4gMG47XG4gICAgfVxuICAgIHJldHVybiBibjtcbn1cblxuLyoqIEZpbmQgdGhlIHByZXZpb3VzIHByaW1lIDw9IG4gKDY0LWJpdCkgKi9cbmV4cG9ydCBmdW5jdGlvbiBwcmV2UHJpbWU2NChuOiBudW1iZXIgfCBiaWdpbnQpOiBiaWdpbnQge1xuICAgIGxldCBibiA9IEJpZ0ludChuKTtcbiAgICBpZiAoYm4gPCAybikgcmV0dXJuIDBuO1xuICAgIGlmIChibiA9PT0gMm4pIHJldHVybiAybjtcbiAgICBpZiAoKGJuICYgMW4pID09PSAwbikgYm4tLTtcbiAgICB3aGlsZSAoIWlzUHJpbWU2NChibikpIHtcbiAgICAgICAgaWYgKGJuIDwgM24pIHJldHVybiAybjtcbiAgICAgICAgYm4gLT0gMm47XG4gICAgfVxuICAgIHJldHVybiBibjtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gREVGQVVMVCBBTElBU0VTICg2NC1iaXQpXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKiBQcmltYWxpdHkgdGVzdCAoZGVmYXVsdHMgdG8gNjQtYml0KSAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzUHJpbWUobjogbnVtYmVyIHwgYmlnaW50KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGlzUHJpbWU2NChuKTtcbn1cblxuLyoqIEZpbmQgbmV4dCBwcmltZSAoZGVmYXVsdHMgdG8gNjQtYml0KSAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5leHRQcmltZShuOiBudW1iZXIgfCBiaWdpbnQpOiBiaWdpbnQge1xuICAgIHJldHVybiBuZXh0UHJpbWU2NChuKTtcbn1cblxuLyoqIEZpbmQgcHJldmlvdXMgcHJpbWUgKGRlZmF1bHRzIHRvIDY0LWJpdCkgKi9cbmV4cG9ydCBmdW5jdGlvbiBwcmV2UHJpbWUobjogbnVtYmVyIHwgYmlnaW50KTogYmlnaW50IHtcbiAgICByZXR1cm4gcHJldlByaW1lNjQobik7XG59XG5cbi8vIFRlc3Qgd2hlbiBydW4gZGlyZWN0bHlcbmlmICh0eXBlb2YgcmVxdWlyZSAhPT0gJ3VuZGVmaW5lZCcgJiYgcmVxdWlyZS5tYWluID09PSBtb2R1bGUpIHtcbiAgICBjb25zb2xlLmxvZyhcIlRlc3Rpbmcgc21jUHJpbWUuLi5cIik7XG4gICAgXG4gICAgLy8gVGVzdCBzbWFsbCBwcmltZXNcbiAgICBjb25zdCBwcmltZXMgPSBbMiwgMywgNSwgNywgMTEsIDEzLCAxNywgMTksIDIzLCAyOSwgMzEsIDM3LCA0MSwgNDMsIDQ3XTtcbiAgICBmb3IgKGNvbnN0IHAgb2YgcHJpbWVzKSB7XG4gICAgICAgIGlmICghaXNQcmltZShwKSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRkFJTDogJHtwfSBzaG91bGQgYmUgcHJpbWVgKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBUZXN0IGNvbXBvc2l0ZXNcbiAgICBjb25zdCBjb21wb3NpdGVzID0gWzQsIDYsIDgsIDksIDEwLCAxMiwgMTQsIDE1LCAxNiwgMTgsIDIwLCAyMSwgMjIsIDI0LCAyNV07XG4gICAgZm9yIChjb25zdCBjIG9mIGNvbXBvc2l0ZXMpIHtcbiAgICAgICAgaWYgKGlzUHJpbWUoYykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZBSUw6ICR7Y30gc2hvdWxkIG5vdCBiZSBwcmltZWApO1xuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIFRlc3Qgc3BlY2lhbCBwc2V1ZG9wcmltZVxuICAgIGlmIChpc1ByaW1lKDMyMTUwMzE3NTEpKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGQUlMOiAzMjE1MDMxNzUxIHNob3VsZCBub3QgYmUgcHJpbWVcIik7XG4gICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICB9XG4gICAgXG4gICAgLy8gVGVzdCBuZXh0L3ByZXYgcHJpbWVcbiAgICBpZiAobmV4dFByaW1lKDEwMCkgIT09IDEwMW4pIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZBSUw6IG5leHRQcmltZSgxMDApIHNob3VsZCBiZSAxMDFcIik7XG4gICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICB9XG4gICAgaWYgKHByZXZQcmltZSgxMDApICE9PSA5N24pIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZBSUw6IHByZXZQcmltZSgxMDApIHNob3VsZCBiZSA5N1wiKTtcbiAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgIH1cbiAgICBcbiAgICAvLyBUZXN0IGxhcmdlIHByaW1lXG4gICAgaWYgKCFpc1ByaW1lNjQoMTAwMDAwMDAwN24pKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGQUlMOiAxMDAwMDAwMDA3IHNob3VsZCBiZSBwcmltZVwiKTtcbiAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZyhcIkFsbCB0ZXN0cyBwYXNzZWQhXCIpO1xufVxuIl19